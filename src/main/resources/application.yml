server:
  port: 8080
  servlet:
    context-path: /

spring:
  application:
    name: kvstore
  profiles:
    active: dev

# KV Store Configuration
kvstore:
  # Storage configuration
  storage:
    data-dir: ./data
    memtable:
      max-size: 100MB
      flush-threshold: 80MB
    sstable:
      max-size: 100MB
      merge-threshold: 5
    wal:
      enabled: true
      sync-interval: 1000  # 1 second in milliseconds
      max-size: 1GB
  
  # Cluster configuration
  cluster:
    nodes:
      - id: node1
        host: localhost
        port: 8080
        grpcPort: 9090
        raftPort: 9091
      # Uncomment for multi-node setup:
      # - id: node2
      #   host: localhost
      #   port: 8082
      #   grpcPort: 9092
      #   raftPort: 9093
      # - id: node3
      #   host: localhost
      #   port: 8084
      #   grpcPort: 9094
      #   raftPort: 9095
    
    # Enable network discovery for multi-node setups
    enable-network-discovery: false
    
    # Enable auto-election for multi-node setups
    auto-election: true
  
  # Raft consensus configuration
  raft:
    # Enable Raft consensus (auto-detected based on node count)
    enabled: true
    
    # Election timeout in milliseconds (only used for multi-node)
    election-timeout: 5000
    
    # Heartbeat interval in milliseconds (only used for multi-node)
    heartbeat-interval: 1000
    
    # Log persistence settings
    log:
      enabled: true
      sync-interval: 1000
      max-size: 1GB
  
  # Compaction configuration
  compaction:
    enabled: false
    interval: 300000  # 5 minutes in milliseconds
    check-interval: 60000  # 1 minute in milliseconds
    max-duration: 300000  # 5 minutes in milliseconds
  
  # gRPC configuration for inter-node communication
  grpc:
    enabled: true
    port: 9090
  
  # Hash ring configuration
  hash-ring:
    virtual-nodes-per-node: 150
    replication-factor: 3
  
  # Node configuration
  node:
    id: ${NODE_ID:node1}
    host: ${NODE_HOST:localhost}
    port: ${NODE_PORT:9090}

# Logging configuration
logging:
  level:
    com.moniepoint.kvstore: INFO
    org.springframework: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/kvstore.log

# Management endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  server:
    port: 8081 